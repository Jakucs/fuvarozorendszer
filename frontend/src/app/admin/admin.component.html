<div class="container mt-5">
  <h2 class="text-center mb-4">Fuvarfeladatok kezelése</h2>

  
  <div class="card p-4 mb-4 shadow-sm">
    <h4>Új munka létrehozása</h4>
    <form (ngSubmit)="createDelivery()" #createForm="ngForm" class="mt-3">
      <div class="mb-3">
        <label class="form-label">Kiindulási cím</label>
        <input
          type="text"
          class="form-control"
          name="start_address"
          [(ngModel)]="newDelivery.start_address"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Érkezési cím</label>
        <input
          type="text"
          class="form-control"
          name="end_address"
          [(ngModel)]="newDelivery.end_address"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Címzett neve</label>
        <input
          type="text"
          class="form-control"
          name="recipient_name"
          [(ngModel)]="newDelivery.recipient_name"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Címzett elérhetősége</label>
        <input
          type="text"
          class="form-control"
          name="recipient_contact"
          [(ngModel)]="newDelivery.recipient_contact"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Fuvarozó</label>
        <div class="input-group">
          <select
            class="form-control"
            name="carrier_id"
            [(ngModel)]="newDelivery.carrier_id"
            required
          >
            <option value="" disabled selected>Válassz fuvarozót...</option>
            <option *ngFor="let carrier of carriers" [value]="carrier.id">
              {{ carrier.name }}
            </option>
          </select>
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="toggleNewCarrier()"
          >
            Új
          </button>
        </div>
      </div>

      <!-- Új fuvarozó űrlap -->
      <div *ngIf="showNewCarrier" class="mb-3 mt-2 border rounded p-3 bg-light">
        <label class="form-label">Új fuvarozó neve</label>
        <input
          type="text"
          class="form-control mb-2"
          [(ngModel)]="newCarrierName"
          placeholder="Pl.: Kiss Trans Kft."
        />
        <button class="btn btn-success btn-sm" type="button" (click)="addCarrier()">
          Hozzáadás
        </button>

      </div>


      <button class="btn btn-success w-100" [disabled]="createForm.invalid">
        Létrehozás
      </button>
    </form>
  </div>

  
  <div class="card p-4 shadow-sm">
    <h4>Meglévő fuvarok</h4>

    <div *ngIf="deliveries.length === 0" class="text-muted text-center mt-3">
      Nincs még fuvarfeladat.
    </div>

    <div *ngFor="let d of deliveries" class="border rounded p-3 my-2">
      <p><strong>Kiindulás:</strong> {{ d.start_address }}</p>
      <p><strong>Érkezés:</strong> {{ d.end_address }}</p>
      <p><strong>Címzett:</strong> {{ d.recipient_name }}</p>
      <p><strong>Elérhetőség:</strong> {{ d.recipient_contact }}</p>

      
      <button
        class="btn btn-primary btn-sm me-2"
        (click)="editDelivery(d)"
      >
        Módosítás
      </button>

      
      <button
        class="btn btn-danger btn-sm me-2"
        (click)="deleteDelivery(d.id)"
      >
        Törlés
      </button>

      
      <div class="mt-3">
        <input
          type="text"
          class="form-control mb-2"
          placeholder="Fuvarozó ID"
          [(ngModel)]="assignCarrierId"
        />
        <button
          class="btn btn-secondary btn-sm"
          (click)="assignToCarrier(d.id)"
        >
          Fuvarozóhoz rendelés
        </button>
      </div>
    </div>
  </div>

  <p *ngIf="successMessage" class="text-success mt-3 text-center">
    {{ successMessage }}
  </p>
  <p *ngIf="errorMessage" class="text-danger mt-3 text-center">
    {{ errorMessage }}
  </p>
</div>

<button 
  class="btn btn-outline-danger position-fixed top-0 end-0 m-3"
  (click)="logout()"
>
  Kilépés
</button>